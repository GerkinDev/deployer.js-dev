<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: objects/command.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: objects/command.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file A command, callable through CLI
 *
 * @author Gerkin
 * @copyright 2016 %company.name%
 * @license http://www.gnu.org/licenses/gpl-3.0.en.html GPLv3
 * @package deployer.js
 *
 * @version %version%
 */

'use strict';

const ActionGroup = require("./actiongroup.js");
const Breadcrumb = require("./breadcrumb.js");
const Arguments = require('./arguments.js');
const Listener = require("./listener.js");

/**
 * Creates a new command
 * @class Command
 * @param   {object}   config Configuration of the command
 * @param   {Command.Type} config.type Type of command
 * @param   {ActionGroup} config.actionGroup Related base action group
 */
class Command{
    constructor ({ awake, command_group,args,actionGroup, eventListeners}){
        if(is_na(arguments[0]))
            throw new Error("Can't create Command with null or undefined config.");

        var _type,
            _actionGroup,
            _commandArgs;

        Object.defineProperties(this, {
            /**
             * @member {Command.Type} type
             * @memberof Command
             * @public
             * @instance
             */
            type: {
                get: function(){
                    return _type;
                },
                set: function(val){
                    if(Object.keys(Command.Type).indexOf(val) != -1){
                        _type = Command.Type[val];
                        return _type;
                    } else if(Object.values(Command.Type).indexOf(val) != -1){
                        _type = val;
                        return _type;
                    } else {
                        return undefined;
                    }
                }
            },
            /**
             * @member {ActionGroup} actionGroup
             * @memberof Command
             * @public
             * @instance
             */
            actionGroup: {
                get: function(){
                    return _actionGroup;
                },
                set: function(val){
                    if(val.constructor.name != "ActionGroup")
                        return undefined;
                    _actionGroup = val;
                    return val;
                    return undefined;
                }
            },
            /**
             * @member {Arguments} commandArgs
             * @memberof Command
             * @public
             * @readonly
             * @instance
             */
            commandArgs: {
                get: function(){return _commandArgs;}
            }
        });

        if(awake === true &amp;&amp; (command_group === false || is_na(command_group))){
            this.type = "PERMANENT"
        } else if((awake === false || is_na(awake)) &amp;&amp; command_group === true){
            this.type = "MOMENTARY"
        } else {
            throw new Error("Could not resolve Command type: listener or command_group");
        }

        if(args){
            _commandArgs = new Arguments(args);
            //console.log(commandArgs);
        }
        if(this.type === Command.Type.MOMENTARY){
            try{
                this.actionGroup = new ActionGroup(actionGroup);
                //console.log(actionGroup);
            } catch(e){
                throw e;
            }
        } else if(this.type === Command.Type.PERMANENT){
            this.listeners = [];
            for(var i = 0, j = eventListeners.length; i &lt; j; i++){
                this.listeners.push(new Listener(eventListeners[i]));
            }
        } else {
            throw new Error("Properties not correctly initialized");
        }
    }


    /**
     * @function setArgumentsGlobal
     * @memberof Command
     * @description Prepare {@link Command#commandArgs} by setting its {@link Arguments#ancestor} with projet-wide constants.
     * @param   {Arguments} args The argument object to put as ancestor
     * @instance
     * @public
     * @author Gerkin
     */
    setArgumentsGlobal (args){
        this.commandArgs.ancestor = new Arguments(args);
        return this;
    };
    /**
     * Execute the command: process arguments then triggers {@link Command.actionGroup}
     * @author Gerkin
     * @param {Function} next Function to execute once finished
     */
    execute (next){
        var breadcrumb = new Breadcrumb();
        this.commandArgs.brewArguments((args)=>{
            this.actionGroup.setArguments(this.commandArgs).execute(breadcrumb, next);
        });
    };
    
    preRun(next){
        async.eachSeries(this.listeners, (listener, cb)=>{
            listener.warmup(cb);
        },next);
    }
}

/**
 * @readonly
 * @enum {number}
 */
Command.Type = {
    PERMANENT: 1,
    MOMENTARY: 2
};

module.exports = Command;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-actions_cp.html">actions/cp</a></li><li><a href="module-actions_exec.html">actions/exec</a></li><li><a href="module-actions_files-version.html">actions/files-version</a></li><li><a href="module-actions_git.html">actions/git</a></li><li><a href="module-actions_less-compile.html">actions/less-compile</a></li><li><a href="module-actions_minify.html">actions/minify</a></li><li><a href="module-actions_svn.html">actions/svn</a></li><li><a href="module-actions_version-history.html">actions/version-history</a></li><li><a href="module-actions_wordpress-upgrade.html">actions/wordpress-upgrade</a></li><li><a href="module-deployer.html">deployer</a></li></ul><h3>Classes</h3><ul><li><a href="ActionGroup.html">ActionGroup</a></li><li><a href="Arguments.html">Arguments</a></li><li><a href="Breadcrumb.html">Breadcrumb</a></li><li><a href="Command.html">Command</a></li><li><a href="CommandAction.html">CommandAction</a></li><li><a href="ComputedArgument.html">ComputedArgument</a></li><li><a href="Listener.html">Listener</a></li><li><a href="ListenerAction.html">ListenerAction</a></li></ul><h3>Global</h3><ul><li><a href="global.html#deployer">deployer</a></li><li><a href="global.html#getFilesRec">getFilesRec</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Tue May 17 2016 18:02:33 GMT-1000 (TAHT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
