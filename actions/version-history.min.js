/**
 * @file Generates the documentation index
 * @description Generates the documentation index
 *
 * @author Gerkin
 * @copyright 2016 GerkinDevelopment
 * @license http://www.gnu.org/licenses/gpl-3.0.en.html GPL v3
 * @package deployer.js
 *
 * @version 0.2.2
 */
const swig=require("swig");module.exports={process:function(e,r){var o=path.resolve(deployer.config.base_path,"templates/"+e.template+"/version-history/index.php.swig"),n={title:e.project_name,author:e.author,now:new Date,head_links:e.head_links,base_url:{resources:null!=e.resources?e.resources:e.base_url+"/resources"},versions:deployer.config.project.versions,current:{version:e.version_minor,url:e.versionUrl},resources:e.resourcesUrl},s=swig.renderFile(o,n),i=e.basePath+"/index.php";async.waterfall([function(e){fs.writeFile(path.resolve(i),s,function(r){e(r)})},function(e){fs.chmod(path.resolve(i),"0777",function(r){e(r)})},function(e){var r=path.resolve(".",deployer.config.configFile);fs.access(r,fs.W_OK,function(o){return o?(deployer.log.warn("No local config file found at "+r),e(o,r)):(deployer.log.verbose("Found LOCAL config file "+r),e(null,r))})},function(e,r){readLocalConfigFile(function(e,o){if(e)return r(e);var s={};s[n.current.version]=n.current.url;var i=merge.recursive(o,{project:{versions:s}});writeLocalConfigFile(i,r)})}],function(e){e&&deployer.log.error("Error while creating version-history",e),r()})}};